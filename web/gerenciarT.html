<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styleG.css" />
    <title>Gerenciar Tarefas</title>
</head>
<body>
    
    <!--Cabeçalho-->

    <header>
        <h1>Gerenciamento de Tarefas</h1>
        <button onclick="window.location.href='index.html'">Cadastro De Usuários</button>
        <button onclick="window.location.href='cadastroT.html'">Cadastro De Tarefas</button>
        <button onclick="window.location.href='gerenciarT.html'">Gerenciar de Tarefas</button>
    </header>

    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />

    <!-- Tarefas -->
    <div class="processo">
        <section id="andamento">

            <div id="afazer" class="column">
                <h3>A Fazer:</h3>
                <div id="afazerList"></div>
            </div>

            <div id="fazendo" class="column">
                <h3>Fazendo:</h3>
                <div id="fazendoList"></div>
            </div>
            
            <div id="pronto" class="column">
                <h3>Pronto:</h3>
                <div id="prontoList"></div>
            </div>

        </section>
    </div>

<script>



    async function fetchTarefas() {
        try {
            const response = await fetch('http://localhost:7000/tarefas');
            if (!response.ok) throw new Error('Erro ao buscar tarefas');
            const tarefas = await response.json();
            renderizarTarefas(tarefas);
        } catch (error) {
            console.error('Erro:', error);
        }
    }

    function renderizarTarefas(tarefas) {
        const afazerList = document.getElementById('afazerList');
        const fazendoList = document.getElementById('fazendoList');
        const prontoList = document.getElementById('prontoList');

        afazerList.innerHTML = '';
        fazendoList.innerHTML = '';
        prontoList.innerHTML = '';

        tarefas.forEach(tarefa => {
            const tarefaDiv = document.createElement('div');
            tarefaDiv.className = 'tarefa';
            tarefaDiv.innerHTML = `
                <p><strong>Descrição:</strong> ${tarefa.descricao}</p>
                <p><strong>Setor:</strong> ${tarefa.setor}</p>
                <p><strong>Prioridade:</strong> ${tarefa.prioridade}</p>
                <p><strong>Status:</strong> ${tarefa.status}</p>
                <button onclick="editarTarefa(${tarefa.id})">Editar</button>
                <button onclick="deletarTarefa(${tarefa.id})">Excluir</button>
            `;

            switch (tarefa.status) {
                case 'afazer':
                    afazerList.appendChild(tarefaDiv);
                    break;
                case 'fazendo':
                    fazendoList.appendChild(tarefaDiv);
                    break;
                case 'pronto':
                    prontoList.appendChild(tarefaDiv);
                    break;
                default:
                    // Se vier algum status inesperado, pode ser ignorado ou tratado aqui
                    break;
            }
        });
    }

    function editarTarefa(id) {
        console.log(`Editar tarefa com ID: ${id}`);
        // Aqui você pode abrir um modal ou redirecionar para um formulário de edição
    }

    async function deletarTarefa(id) {
        if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
            try {
                const response = await fetch(`http://localhost:7000/tarefas/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('Erro ao excluir tarefa');
                fetchTarefas(); // Recarrega após exclusão
            } catch (error) {
                console.error('Erro:', error);
            }
        }
    }

    window.onload = fetchTarefas;
</script>

</body>
</html>
